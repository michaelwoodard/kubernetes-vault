apiVersion: v1
kind: Service
metadata:
  name: vault
  labels:
    app: vault
spec:
  ports:
    - name: vault
      port: 8200
  selector:
    app: vault
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: vault
data:
  conf.hcl: |-
    listener "tcp" {
        address = "0.0.0.0:8200"
        tls_cert_file = "/vault/config/cert.pem"
        tls_key_file = "/vault/config/cert.key"
    }

    storage "zookeeper" {
      address = "zk-cs.default.svc.cluster.local:2181"
      path    = "vault/"
      advertise_addr = "https://vault:8200"
    }

  cert.pem: |-
    -----BEGIN CERTIFICATE-----
    MIIF1TCCA72gAwIBAgICEAAwDQYJKoZIhvcNAQELBQAwgYgxCzAJBgNVBAYTAlVT
    MREwDwYDVQQIDAhWaXJnaW5pYTEqMCgGA1UECgwhS2Fpbm9zIEhlYWx0aGNhcmUg
    U29sdXRpb25zLCBMTEMuMTowOAYDVQQDDDFLYWlub3MgSGVhbHRoY2FyZSBTb2x1
    dGlvbnMsIExMQy4gSW50ZXJtZWRpYXRlIENBMB4XDTE3MTIwNDIwMzIxMVoXDTE4
    MTIxNDIwMzIxMVowbzELMAkGA1UEBhMCVVMxETAPBgNVBAgMCFZpcmdpbmlhMREw
    DwYDVQQHDAhSaWNobW9uZDEqMCgGA1UECgwhS2Fpbm9zIEhlYWx0aGNhcmUgU29s
    dXRpb25zLCBMTEMuMQ4wDAYDVQQDDAV2YXVsdDCCASIwDQYJKoZIhvcNAQEBBQAD
    ggEPADCCAQoCggEBALGhQHBtOS4UPP5yJla0Menw5daAtW744BDkwk5+MqVMV88y
    1NnRMmyxem19Vb0FGqcPs60lXqbhQMcCOzQRWktoJHQrAcKj1CtcC7icUFCK2Y3p
    fm4X4yBJUGesdOYCQ73oqpYH5IjTw2ZOV644GV9jkZgvrMy91jymQmOrOdTkHvGk
    bWCRoXM8sNZSWBkCV1OrhG973K/cBavRLOnH0CNQY2R/aLvAlfdYu+uUHDVfgkbL
    UliuL59A170aVmOFbb8xCuAGN51/EesxwRS6wCgKzuPUWIh5RnvKKCNjYmWZiDvt
    M3tmFCpfgYOEhgN/y+QhHl7RwdIiLCJMnndb6EkCAwEAAaOCAV8wggFbMAkGA1Ud
    EwQCMAAwEQYJYIZIAYb4QgEBBAQDAgZAMDMGCWCGSAGG+EIBDQQmFiRPcGVuU1NM
    IEdlbmVyYXRlZCBTZXJ2ZXIgQ2VydGlmaWNhdGUwHQYDVR0OBBYEFPQ0bkX5Kf3Q
    1LmqC+3uOsb603BEMIHBBgNVHSMEgbkwgbaAFI5v9rg5ZzG7q+Ek1o5HLWTUAqgb
    oYGZpIGWMIGTMQswCQYDVQQGEwJVUzERMA8GA1UECAwIVmlyZ2luaWExETAPBgNV
    BAcMCFJpY2htb25kMSowKAYDVQQKDCFLYWlub3MgSGVhbHRoY2FyZSBTb2x1dGlv
    bnMsIExMQy4xMjAwBgNVBAMMKUthaW5vcyBIZWFsdGhjYXJlIFNvbHV0aW9ucywg
    TExDLiBSb290IENBggIQADAOBgNVHQ8BAf8EBAMCBaAwEwYDVR0lBAwwCgYIKwYB
    BQUHAwEwDQYJKoZIhvcNAQELBQADggIBAH259FbNQin0ARYnaE2XmZZW99vuO+Nb
    CbOgckwC5hOlfPkrXdGQ2IoRjsHoxX5732L+oh0CKKszOI9tOO/2WkgX9wY5VKAZ
    bsZzR3WEKy1Dc5qs3yNZcqQYsquv7B0pSU/dzGUk6woH5SwDb2VLXCH+ZWB9cRWK
    Us+PPXtGtM5MP+ggh3o/+BKr2hMsAz0R//4C0Ff8LVgMKVaDTARoGLmh42eQK0q6
    zjV0IZ8JM6j54yFGuFx+Jyv5ctwoVcyAYILLY6quM0L/z7lJaWSr9AYWqC9u0hVk
    VXD1HqP2k2XBCcr2mCiIu4XH8juTZkQuWou3vHlx0adceAgD5RzFp/3+64RrboGI
    Dku6G8ynliSzgKZxTC6mxR08ty/8oG6PMuUlKXgVi8qrK1I82Wvj4AhkYECWLAyu
    uHshgfoZr2HuHgyPqQjbxiWgGMenJY7EXjDYIQnVJHgeJX/kKSuaPFgwlpJdEqU5
    5HhPgdmNlGhf1twFxLPXmk1wzU/5ad1L5NADh/mRcR3TCqw957Ua8reMV3dFjKm4
    xD8uLiYQSPlbOLO+YprpY/5+27Vecwb0QF6ZVWKhGaLDSNQBxtNNX5shUsixtfQH
    B8Xzn4TiIBOyQNLiQudDSsVvhcgTL+c6Gs5MwI/Cg+ZJk4uQliFzNbAdj4mVPTf5
    niI25P9+LmVa
    -----END CERTIFICATE-----

  cert.key: |-
    -----BEGIN RSA PRIVATE KEY-----
    MIIEowIBAAKCAQEAsaFAcG05LhQ8/nImVrQx6fDl1oC1bvjgEOTCTn4ypUxXzzLU
    2dEybLF6bX1VvQUapw+zrSVepuFAxwI7NBFaS2gkdCsBwqPUK1wLuJxQUIrZjel+
    bhfjIElQZ6x05gJDveiqlgfkiNPDZk5XrjgZX2ORmC+szL3WPKZCY6s51OQe8aRt
    YJGhczyw1lJYGQJXU6uEb3vcr9wFq9Es6cfQI1BjZH9ou8CV91i765QcNV+CRstS
    WK4vn0DXvRpWY4VtvzEK4AY3nX8R6zHBFLrAKArO49RYiHlGe8ooI2NiZZmIO+0z
    e2YUKl+Bg4SGA3/L5CEeXtHB0iIsIkyed1voSQIDAQABAoIBAGIhEAVMAbO4EH4M
    t6tcftqbb42Rqym0KayLg+BzDS2OQFBB556xWCb94QGNpQj4QeIa5Yr4wxJ0DCIk
    1GoOUBCqZsEaZS2O7g5KGluRVzk3i7o/TM4rOhlDBz1O44GRrLTETUD2+USxoBfr
    nbqsWS/+RJeLdu3gzfLRcom3NQqrUv0iJP0OuHicZM2EBFtX92v7EfuXs5D0EMoB
    30SDgqdIR7ox2rcrNV0UjecGN7CN26RYgckdYY+pEqplDpENST3nBblfv1fyV78u
    esDsUXHRCxvLKhC3A1iaCvAz5eKk66zqanBusHg2NuBW9Dhtbg9LAiqSaQT/WfI+
    IfRohdECgYEA6MDBlENXgNe0/BlaXujnHYJKIWRuiH9kRS4X3l5nRgaeHMfxCGkD
    h09VZEv6umz7eLEKR739sBaTytzhEyv/bG509cXIZZw91UQMr0vGSOOiM0I+WSgn
    Vm5pS22gJoWbSfTs9RTVlmmhO9FOYwCPbIje/JAQE9qKmwkzr6FMIz0CgYEAw18O
    zLQSTPXq7aNNgNUdzSHdSFMn3VhQifBjGNwe5IAMoIVlICXlTs0M/K5iKSH9GUJ1
    XHkjGQGeSofE9FkPwA6kQZ4lETo9slRNGRYY7XoHzS9RsbX/OPZlNsbXAqsBbhIC
    6f1tVe47dDJ6UvTJHJhy7oo2+xCVupB5VBKeuf0CgYA83JKB424RKdaQiUyhPsOY
    asZZnvpsROuCT4A8THEy1W4o1nuHmHYsvqj0lg2VDARh1eF7Swn4Lp8sz78nFT0w
    LF33GmXBdC6TAr1SZT0POD7kqnDFPYOzzSFJcPwMtqkZmKsRlwYW074udxfJOY9H
    cS7l2gHqPx45Vhmm1kWjfQKBgQC7cQ8E7NsGBYag+mVYbp/J+GySgF2l6p5SyVR6
    PG5TMltrArCUGGeZo/eK0lARQK/QtUdeMkavLjNNNFeNS4ll7WZAIldT4Pnihyj1
    IZNG/CZSAM0zX/Z/Ez7mP/13bNPRY+xxzJhCsm9OO0PLJVlyWv0hyW+Yjz/oH8aY
    F8k7jQKBgHUrkApLWDXWzr0K5PHHz9P/CcUFe297Fvm6JcGeKFjgIfzyV/LK1Bzo
    ldlYYLr+PbKV9epL6KVGZ1pGTawHFtumL2dFp14O2c0okyzEaWEQojOl3jnHVuDm
    ijFZLMC1KA918lRtA53EdI8wxO6kA7WmVLEszRGQmEjQzI80nErF
    -----END RSA PRIVATE KEY-----
---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  labels:
    app: vault
  name: vault
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: vault
    spec:
      containers:
      - image: vault
        command:
          - vault
          - server
          - -config=/vault/config/
        name: vault
        ports:
        - containerPort: 8200
          name: vaultport
          protocol: TCP
        volumeMounts:
        - name: config-volume
          mountPath: /vault/config
        securityContext:
         capabilities:
           add:
             - IPC_LOCK
      volumes:
        - name: config-volume
          configMap:
            name: vault